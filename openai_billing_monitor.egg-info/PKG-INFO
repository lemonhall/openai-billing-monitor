Metadata-Version: 2.4
Name: openai-billing-monitor
Version: 0.1.0
Summary: A Python library for monitoring and controlling OpenAI API costs
Home-page: https://github.com/yourusername/openai-billing-monitor
Author: Your Name
Author-email: Your Name <your.email@example.com>
License: MIT
Project-URL: Homepage, https://github.com/yourusername/openai-billing-monitor
Project-URL: Repository, https://github.com/yourusername/openai-billing-monitor
Project-URL: Issues, https://github.com/yourusername/openai-billing-monitor/issues
Classifier: Development Status :: 3 - Alpha
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Requires-Python: >=3.8
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: openai>=1.0.0
Requires-Dist: pydantic>=2.0.0
Requires-Dist: pyyaml>=6.0
Requires-Dist: tiktoken>=0.4.0
Provides-Extra: gui
Requires-Dist: tkinter; extra == "gui"
Provides-Extra: dev
Requires-Dist: pytest; extra == "dev"
Requires-Dist: black; extra == "dev"
Requires-Dist: flake8; extra == "dev"
Requires-Dist: mypy; extra == "dev"
Dynamic: author
Dynamic: home-page
Dynamic: license-file
Dynamic: requires-python

# OpenAI Billing Monitor

[![PyPI version](https://badge.fury.io/py/openai-billing-monitor.svg)](https://badge.fury.io/py/openai-billing-monitor)
[![Python 3.8+](https://img.shields.io/badge/python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

ä¸€ä¸ªç”¨äºç›‘æ§å’Œæ§åˆ¶OpenAI APIæˆæœ¬çš„Pythonåº“ï¼Œæä¾›ä½ä¾µå…¥å¼é›†æˆã€å®æ—¶ç›‘æ§å’Œæˆæœ¬æ§åˆ¶åŠŸèƒ½ã€‚

## âœ¨ ç‰¹æ€§

- ğŸ” **å®æ—¶ç›‘æ§**: è‡ªåŠ¨è·Ÿè¸ªtokenä½¿ç”¨é‡å’ŒAPIæˆæœ¬
- ğŸ›¡ï¸ **æˆæœ¬æ§åˆ¶**: è®¾ç½®æ—¥/æœˆæˆæœ¬å’Œtokené™åˆ¶ï¼Œè¶…é™è‡ªåŠ¨é˜»æ­¢è¯·æ±‚
- ğŸ”§ **ä½ä¾µå…¥æ€§**: é€šè¿‡è£…é¥°å™¨æˆ–åŒ…è£…å™¨è½»æ¾é›†æˆï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç 
- ğŸ¯ **å¤šæ¨¡å‹æ”¯æŒ**: å†…ç½®ä¸»æµAIæ¨¡å‹è®¡è´¹é…ç½®ï¼ˆOpenAIã€Qwenã€Claudeç­‰ï¼‰
- ğŸ“Š **å¯è§†åŒ–ç•Œé¢**: Tkinter GUIç”¨äºé…ç½®ç®¡ç†å’Œä½¿ç”¨ç›‘æ§
- ğŸ’¾ **æŒä¹…åŒ–å­˜å‚¨**: è‡ªåŠ¨ä¿å­˜ä½¿ç”¨ç»Ÿè®¡å’Œé…ç½®
- âš ï¸ **æ™ºèƒ½é¢„è­¦**: æ¥è¿‘é™åˆ¶æ—¶è‡ªåŠ¨è­¦å‘Š
- ğŸ“ˆ **è¯¦ç»†ç»Ÿè®¡**: æä¾›å…¨é¢çš„ä½¿ç”¨åˆ†æå’ŒæŠ¥å‘Š

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…

```bash
pip install openai-billing-monitor
```

### åŸºæœ¬ä½¿ç”¨

#### æ–¹å¼1: ä½¿ç”¨è£…é¥°å™¨ï¼ˆæ¨èï¼‰

```python
import openai
from openai_billing import monitor_openai_call

# è®¾ç½®OpenAI APIå¯†é’¥
openai.api_key = "your-api-key"

# ä½¿ç”¨è£…é¥°å™¨ç›‘æ§APIè°ƒç”¨
@monitor_openai_call(model_name="gpt-4")
def chat_with_gpt4(messages):
    client = openai.OpenAI()
    return client.chat.completions.create(
        model="gpt-4",
        messages=messages
    )

# æ­£å¸¸è°ƒç”¨ï¼Œè‡ªåŠ¨ç›‘æ§
response = chat_with_gpt4([
    {"role": "user", "content": "Hello, how are you?"}
])
```

#### æ–¹å¼2: ä½¿ç”¨åŒ…è£…å™¨

```python
from openai_billing import OpenAIWrapper

# åˆ›å»ºåŒ…è£…çš„OpenAIå®¢æˆ·ç«¯
client = OpenAIWrapper(api_key="your-api-key")

# æ­£å¸¸ä½¿ç”¨ï¼Œè‡ªåŠ¨ç›‘æ§
response = client.chat.completions.create(
    model="gpt-4",
    messages=[{"role": "user", "content": "Hello!"}]
)

# æŸ¥çœ‹ä½¿ç”¨ç»Ÿè®¡
print(client.get_usage_summary())
```

#### æ–¹å¼3: æ‰‹åŠ¨ç›‘æ§

```python
from openai_billing import BillingMonitor
import openai

# åˆ›å»ºç›‘æ§å™¨
monitor = BillingMonitor()

# æ‰‹åŠ¨è·Ÿè¸ªä½¿ç”¨
client = openai.OpenAI()
response = client.chat.completions.create(
    model="gpt-4",
    messages=[{"role": "user", "content": "Hello!"}]
)

# è·Ÿè¸ªå“åº”
usage_info = monitor.track_openai_response(
    response.model_dump(), 
    "gpt-4"
)
print(f"æœ¬æ¬¡è°ƒç”¨æˆæœ¬: ${usage_info['cost']:.4f}")
```

## ğŸ“Š GUIç•Œé¢

å¯åŠ¨å›¾å½¢ç•Œé¢è¿›è¡Œé…ç½®å’Œç›‘æ§ï¼š

```bash
# å‘½ä»¤è¡Œå¯åŠ¨
openai-billing-gui

# æˆ–åœ¨Pythonä¸­å¯åŠ¨
from openai_billing.gui import main
main()
```

GUIåŠŸèƒ½åŒ…æ‹¬ï¼š
- ğŸ“ˆ å®æ—¶ä½¿ç”¨ç»Ÿè®¡æ˜¾ç¤º
- âš™ï¸ æ¨¡å‹é…ç½®ç®¡ç†
- ğŸšï¸ é˜ˆå€¼è®¾ç½®
- ğŸ“Š è¯¦ç»†ç»Ÿè®¡æŠ¥å‘Š
- ğŸ”„ è‡ªåŠ¨åˆ·æ–°ç›‘æ§

## ğŸ”§ é…ç½®

### åŸºæœ¬é…ç½®

```python
from openai_billing import BillingMonitor
from openai_billing.models import ThresholdConfig

monitor = BillingMonitor()

# è®¾ç½®é˜ˆå€¼
thresholds = ThresholdConfig(
    daily_cost_limit=10.0,      # æ—¥æˆæœ¬é™åˆ¶ $10
    monthly_cost_limit=100.0,   # æœˆæˆæœ¬é™åˆ¶ $100
    daily_token_limit=1000000,  # æ—¥tokené™åˆ¶ 100ä¸‡
    monthly_token_limit=10000000, # æœˆtokené™åˆ¶ 1000ä¸‡
    warning_threshold=0.8       # 80%æ—¶è­¦å‘Š
)

monitor.config_manager.update_thresholds(thresholds)
```

### æ·»åŠ è‡ªå®šä¹‰æ¨¡å‹

```python
from openai_billing.models import ModelConfig

# æ·»åŠ è‡ªå®šä¹‰æ¨¡å‹é…ç½®
custom_model = ModelConfig(
    name="custom-model",
    input_token_price=0.001,    # æ¯1000è¾“å…¥tokenä»·æ ¼
    output_token_price=0.002,   # æ¯1000è¾“å‡ºtokenä»·æ ¼
    max_tokens=8192
)

monitor.config_manager.add_model_config(custom_model)
```

### é…ç½®æ–‡ä»¶ä½ç½®

é…ç½®æ–‡ä»¶é»˜è®¤å­˜å‚¨åœ¨ï¼š
- Windows: `%USERPROFILE%\.openai_billing\`
- macOS/Linux: `~/.openai_billing/`

åŒ…å«æ–‡ä»¶ï¼š
- `openai_billing_config.yaml`: ä¸»é…ç½®æ–‡ä»¶
- `openai_billing_stats.json`: ä½¿ç”¨ç»Ÿè®¡æ•°æ®

## ğŸ“ˆ ä½¿ç”¨ç»Ÿè®¡

### è·å–ç»Ÿè®¡æ‘˜è¦

```python
# è·å–å®Œæ•´ç»Ÿè®¡
summary = monitor.get_usage_summary()
print(f"æ€»æˆæœ¬: ${summary['total_cost']:.4f}")
print(f"ä»Šæ—¥æˆæœ¬: ${summary['daily_cost']:.4f}")
print(f"æœ¬æœˆæˆæœ¬: ${summary['monthly_cost']:.4f}")
print(f"æ€»è¯·æ±‚æ•°: {summary['total_requests']}")
```

### é‡ç½®ç»Ÿè®¡

```python
# é‡ç½®æ‰€æœ‰ç»Ÿè®¡
monitor.reset_usage_stats("all")

# é‡ç½®æ—¥ç»Ÿè®¡
monitor.reset_usage_stats("daily")

# é‡ç½®æœˆç»Ÿè®¡
monitor.reset_usage_stats("monthly")
```

## ğŸ› ï¸ é«˜çº§åŠŸèƒ½

### é¢„æ£€æŸ¥è¯·æ±‚

```python
# æ£€æŸ¥è¯·æ±‚æ˜¯å¦ä¼šè¶…é™
check_result = monitor.check_limits_before_request("gpt-4", 1000)
if check_result["allowed"]:
    # æ‰§è¡ŒAPIè°ƒç”¨
    pass
else:
    print("è¯·æ±‚è¢«é˜»æ­¢:", check_result["warnings"])
```

### è®¾ç½®å›è°ƒå‡½æ•°

```python
def on_warning(warning_type, usage_info):
    print(f"è­¦å‘Š: {warning_type}")
    print(f"å½“å‰ä½¿ç”¨: {usage_info}")

def on_exceeded(exceeded_type, usage_info):
    print(f"è¶…é™: {exceeded_type}")
    # å‘é€é€šçŸ¥ã€è®°å½•æ—¥å¿—ç­‰

monitor.on_threshold_warning = on_warning
monitor.on_threshold_exceeded = on_exceeded
```

### ä¸Šä¸‹æ–‡ç®¡ç†å™¨

```python
from openai_billing.core.wrapper import temporary_monitoring, disable_monitoring

# ä¸´æ—¶å¯ç”¨ç›‘æ§
with temporary_monitoring():
    response = client.chat.completions.create(...)

# ä¸´æ—¶ç¦ç”¨ç›‘æ§
with disable_monitoring():
    response = client.chat.completions.create(...)
```

## ğŸ¯ æ”¯æŒçš„æ¨¡å‹

å†…ç½®æ”¯æŒä»¥ä¸‹æ¨¡å‹çš„è®¡è´¹é…ç½®ï¼š

### OpenAIæ¨¡å‹
- GPT-4 ç³»åˆ— (gpt-4, gpt-4-turbo, gpt-4o, gpt-4o-mini)
- GPT-3.5 ç³»åˆ— (gpt-3.5-turbo, gpt-3.5-turbo-16k)

### å…¶ä»–å‚å•†æ¨¡å‹
- **Qwen**: qwen-turbo, qwen-plus, qwen-max
- **Claude**: claude-3-opus, claude-3-sonnet, claude-3-haiku
- **Gemini**: gemini-pro, gemini-pro-vision
- **DeepSeek**: deepseek-chat, deepseek-coder
- **Moonshot**: moonshot-v1-8k/32k/128k
- **Baichuan**: baichuan2-turbo

æ›´å¤šæ¨¡å‹é…ç½®å¯é€šè¿‡GUIæˆ–ä»£ç æ·»åŠ ã€‚

## ğŸ”’ å¼‚å¸¸å¤„ç†

```python
from openai_billing.core.exceptions import (
    ThresholdExceededException,
    ModelNotConfiguredException
)

try:
    response = monitored_function()
except ThresholdExceededException as e:
    print(f"è¾¾åˆ°é™åˆ¶: {e.threshold_type}")
    print(f"å½“å‰å€¼: {e.current_value}, é™åˆ¶: {e.limit_value}")
except ModelNotConfiguredException as e:
    print(f"æ¨¡å‹æœªé…ç½®: {e.model_name}")
```

## ğŸ“Š å¯¼å‡ºæ•°æ®

### å¯¼å‡ºé…ç½®

```python
# å¯¼å‡ºä¸ºYAML
monitor.config_manager.export_config("my_config.yaml")

# å¯¼å‡ºä¸ºJSON
monitor.config_manager.export_config("my_config.json")
```

### å¯¼å‡ºç»Ÿè®¡æ•°æ®

```python
import json

# è·å–å¹¶ä¿å­˜ç»Ÿè®¡æ•°æ®
summary = monitor.get_usage_summary()
with open("usage_stats.json", "w") as f:
    json.dump(summary, f, indent=2, default=str)
```

## ğŸ”„ ä¸ç°æœ‰ä»£ç é›†æˆ

### æœ€å°ä¾µå…¥å¼é›†æˆ

```python
# åŸæœ‰ä»£ç 
import openai
client = openai.OpenAI()

# æ·»åŠ ç›‘æ§ï¼ˆåªéœ€ä¸€è¡Œï¼‰
from openai_billing import patch_openai_client
client = patch_openai_client(client)

# å…¶ä»–ä»£ç æ— éœ€ä¿®æ”¹
response = client.chat.completions.create(...)
```

### æ‰¹é‡ç›‘æ§

```python
# å¯¹å¤šä¸ªå‡½æ•°æ‰¹é‡æ·»åŠ ç›‘æ§
functions_to_monitor = [func1, func2, func3]
for func in functions_to_monitor:
    func = monitor_openai_call()(func)
```

## ğŸš€ éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

### ç¯å¢ƒå˜é‡é…ç½®

```bash
export OPENAI_BILLING_CONFIG_DIR="/path/to/config"
export OPENAI_BILLING_ENABLED="true"
export OPENAI_BILLING_AUTO_SAVE="true"
```

### Dockeré›†æˆ

```dockerfile
FROM python:3.9
RUN pip install openai-billing-monitor
COPY config/ /app/.openai_billing/
ENV OPENAI_BILLING_CONFIG_DIR=/app/.openai_billing
# å…¶ä»–é…ç½®...
```

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

1. Forké¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. åˆ›å»ºPull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä½¿ç”¨MITè®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ†˜ æ”¯æŒ

- ğŸ“– [æ–‡æ¡£](https://github.com/yourusername/openai-billing-monitor/wiki)
- ğŸ› [Issues](https://github.com/yourusername/openai-billing-monitor/issues)
- ğŸ’¬ [Discussions](https://github.com/yourusername/openai-billing-monitor/discussions)

## ğŸ“‹ æ›´æ–°æ—¥å¿—

### v0.1.0
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- åŸºæœ¬ç›‘æ§åŠŸèƒ½
- GUIç•Œé¢
- å¤šæ¨¡å‹æ”¯æŒ
- é…ç½®ç®¡ç†

---

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ªæ˜Ÿæ ‡æ”¯æŒä¸€ä¸‹ï¼**
